title Chainlink Pricing TVL

participant ChainlinkAgg#lightblue
participant APYAssetAllocationRegistry#pink
participant DefiProtocol
participant APYPeripheryContract
participant AggregatorV3Interface(TVL)#lightblue

ChainlinkAgg -> APYAssetAllocationRegistry: getAssetAllocationIds()
loop#yellow iterate through all asset ids
activate ChainlinkAgg
ChainlinkAgg ->APYAssetAllocationRegistry: symbolOf(id)
ChainlinkAgg ->APYAssetAllocationRegistry: decimalsOf(id)
ChainlinkAgg ->APYAssetAllocationRegistry: balanceOf(id)
activate APYAssetAllocationRegistry
alt#lightyellow Protocol
APYAssetAllocationRegistry -> DefiProtocol: balanceOf()
else #lightyellow Periphery
APYAssetAllocationRegistry -> APYPeripheryContract: balanceOf()
end
APYAssetAllocationRegistry -->ChainlinkAgg:
deactivate APYAssetAllocationRegistry
end
ChainlinkAgg ->ChainlinkAgg: uses symbol + decimals + bal to price
ChainlinkAgg -> AggregatorV3Interface(TVL): publish(); publishes summed TVL
